import os
import random
from tqdm import tqdm
from dataio import read_file
from dataio import write_file

# List of 50 sentence templates
PROMPT_TEMPLATE_LIST = [
    '玉山銀行在法人說明會上，向投資法人展示Q one的最新財報，並討論經濟成長率的影響。此會議中也分享了近期的貨幣政策對銀行淨收益的影響。有出現: {}. 開始吧.',
    '法人說明會上，玉山金控介紹其淨值和雙重槓桿比率，強調穩健的財務管理。陳美滿更進一步分析了該季的稅後淨利及DPS分配計畫。有出現: {}. 開始吧.',
    '玉山銀行的法人說明會上，管理層深入解析淨手續費和市占率的變化，讓投資法人了解最新的YOY增長。謝冠仁還分享了銀行在消金和放款方面的策略。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行探討了NIM和Spread的最新數據，並說明存放比和NPL Ratio的變化趨勢。這些資訊有助於法人了解玉山的風險管理狀況。有出現: {}. 開始吧.',
    '玉山銀行的法人說明會詳細介紹了企金和C I Ratio的最新狀況。柯治宏表示，資本適足率和BIS Ratio保持穩健，是該行長期發展的基石。有出現: {}. 開始吧.',
    '在法人說明會上，玉山銀行介紹了其在pi錢包上的創新應用，以及預期放款比率的最新數據。與會的投資法人對此展現出極大興趣。有出現: {}. 開始吧.',
    '玉山銀行法人說明會上，陳美滿介紹了The Banker對玉山的最新評價，強調其在CSR方面的表現。該行的net revenue持續增長，顯示其穩健的經營策略。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行討論了Fixed Income和其他收入（other income）的增長情況。法人的淨手續費在市場中取得了顯著的市占率。有出現: {}. 開始吧.',
    '玉山銀行透過法人說明會，公開了本季度的放款和LDR數據。消金業務的成長也被強調，並預期能帶動NIM進一步提升。有出現: {}. 開始吧.',
    '法人說明會上，玉山銀行分享了其在spread上的優勢，並提供了存放比和NPL Ratio的最新統計。法人對銀行的穩健經營深表認同。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會中強調了企金業務的發展，以及C I Ratio對整體經營的影響。這些數據都展現出該行的財務穩健性。有出現: {}. 開始吧.',
    '在法人說明會上，玉山銀行報告了其資本適足率和BIS Ratio的最新狀況。EPS和OCI的增長更是法人的關注焦點。有出現: {}. 開始吧.',
    '玉山銀行法人說明會上，管理層詳細介紹了AC和PML在該季度的表現，並強調了財富管理策略的調整方向。這些資訊有助於法人投資者做出決策。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會上探討了IPO市場的最新動態，並介紹了AO業務的發展潛力。南山人壽和法金業務也成為討論焦點。有出現: {}. 開始吧.',
    '法人說明會上，玉山銀行回顧了上季度的財務表現，特別強調了net revenue和淨收益。陳美滿表示，這些數據顯示了銀行穩健的經營策略。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行強調了market share的擴展策略，並探討了基點（basis point）變動對預放的影響。這些資訊有助於法人了解未來投資方向。有出現: {}. 開始吧.',
    '玉山銀行法人說明會上，管理層討論了近期SWAP交易的表現，並強調聯貸業務的發展潛力。這些策略有助於銀行擴大其市場份額。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行分析了近期歐洲、台灣和美國市場的經濟狀況。FX交易業務的成長，成為法人投資者關注的焦點。有出現: {}. 開始吧.',
    '玉山銀行透過法人說明會，介紹了法說會的內容及IR活動的成果。這些舉措有助於增強投資者的信心。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行強調了先進技術在銀行業的應用，並探討了FED貨幣政策對該行業務的影響。這讓投資法人更深入了解其經營策略。有出現: {}. 開始吧.',
    '玉山銀行法人說明會中，分析了中國市場的發展動態，並強調在亞洲四小龍中取得的市場優勢。主計處的最新數據也為法人提供重要參考。有出現: {}. 開始吧.',
    '在法人說明會上，玉山銀行強調其twA Plus信用評等，並分析了S&P對該行的最新評價。這些指標顯示出玉山銀行的穩健財務結構。有出現: {}. 開始吧.',
    '玉山銀行法人說明會中，討論了Net Profit的最新數據，並探討Large Corporate業務的增長趨勢。這些資訊有助於法人投資者評估投資風險。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行詳細介紹了pi信用卡的發展策略，以及稅後盈餘的增長情況。這為法人投資者提供了重要的投資參考。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會上，分享了香港和新加坡市場的最新發展趨勢。VP和曝險風險管理也成為會議的討論重點。有出現: {}. 開始吧.',
    '法人說明會中，玉山銀行介紹了深圳、廣州和東莞等城市的業務拓展情況，強調在央企合作中的優勢。這些動態對法人投資者來說至關重要。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行回顧了摩根大通合作項目，並討論了關聯稅制的最新政策。這些內容有助於法人評估未來投資機會。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會上強調了南山廣場和美林證券的業務合作，展示其在財富管理領域的領先地位。法人對此策略表示看好。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行介紹了PCHOME合作方案，並分享了智能金融處的創新應用。這些舉措讓法人看到了玉山銀行的數位轉型潛力。有出現: {}. 開始吧.',
    '玉山銀行法人說明會上，UBear產品策略和MMA市場分析成為討論焦點。法人的反饋表示，這些創新產品有助於銀行增強市場競爭力。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行強調了企金法的最新動態，並分享了IF業務的發展前景。這些資訊為法人投資者提供了決策依據。出現: {}. 開始吧.',
    '玉山銀行法人說明會中，討論了聯準會貨幣政策對該行業務的影響，並分享了半導體五G市場的發展機遇。這為投資者提供了前瞻性的市場洞察。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行探討了Global Finance的最新評價，並強調英國和亞洲市場的重要性。這些資訊對法人投資者來說極具參考價值。有出現: {}. 開始吧.',
    '玉山銀行透過法人說明會，分享了淨手收和淨利收的增長趨勢，並介紹SME市場策略。這些資訊有助於法人更好地評估投資風險。有出現: {}. 開始吧.',
    '法人說明會上，玉山銀行討論了逾放比和財管業務的現況，強調穩健的風險管理策略。這為法人投資者提供了重要的參考依據。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行介紹了熔斷機制對市場的影響，並探討了元大和JP合作計畫。這些資訊有助於法人了解該行的發展動向。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會中強調了創投業務的發展，以及央行政策對銀行業務的影響。這些內容讓法人投資者對未來的投資策略有了新的方向。有出現: {}. 開始吧.',
    '法人說明會上，玉山銀行報告了BP和指數型產品的最新發展，並介紹了e.Fingo平台的創新應用。法人對此策略表示支持。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行強調了MSCI ESG Ratings的最新評等，並介紹了TCFD和GRI的應用情況。這些環境、社會與公司治理（ESG）資訊對法人投資者的決策極為重要。有出現: {}. 開始吧.',
    '玉山銀行法人說明會上，管理層討論了SASB標準在財報中的應用，並分析了高單位數增長（high single digit）的業務表現。這些內容有助於法人更全面地了解銀行的經營狀況。有出現: {}. 開始吧.',
    '法人說明會中，玉山銀行報告了近期的瑞士信貸合作動態，並探討台灣市場的發展前景。這些資訊為法人提供了最新的市場洞察。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會中強調了日盛和統一企業的策略合作，並介紹了mortgage loan的最新趨勢。這有助於法人投資者評估未來的業務機會。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行探討了consumer banking和corporate banking的最新發展動態，並報告了NCD市場的變化。這些內容對法人投資者的決策具有重要參考價值。有出現: {}. 開始吧.',
    '法人說明會上，玉山銀行介紹了RM和PVC在該季度的表現，並探討wealth management的發展方向。這讓法人對銀行的業務規劃有了更深入的了解。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會中強調OSU和Carrefour家樂福的合作計畫，並介紹Jasons market的業務增長情況。這為法人提供了最新的市場資訊。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行討論了fifty fifty投資策略的應用，並報告了VOA指標的最新狀況。這些資訊為法人提供了重要的投資參考。有出現: {}. 開始吧.',
    '玉山銀行法人說明會上，管理層分析了終端消費的變化趨勢，並探討current ratio對公司營運的影響。法人對銀行的市場洞察力表示肯定。有出現: {}. 開始吧.',
    '在法人說明會中，玉山銀行介紹了富比士（Forbes）對銀行的評價，並分享了forbes bank排名中的最新動態。這有助於法人了解銀行的市場定位。有出現: {}. 開始吧.',
    '玉山銀行在法人說明會中強調了Sustainalytics評等，並報告PS ratio的最新狀況。這些ESG和財務數據讓法人投資者對銀行的未來發展更具信心。有出現: {}. 開始吧.',
    '法人說明會上，玉山銀行討論了摩根士丹利（Morgan Stanley JP）的合作計畫，並介紹了吳宏斌在策略推動上的重要角色。這些資訊為法人提供了全面的市場展望。有出現: {}. 開始吧.',
]
# PROMPT_TEMPLATE_LIST = [
#     '《玉山金控》 在此次法人說明會上介紹了【雙重槓桿比率】的最新變化。法人代表[陳美滿]表示【GDP】預測將對未來經濟產生重要影響。有出現: {}. 開始吧.',
#     '[柯治宏] 在會上提到了【稅後淨利】的增長，並強調《玉山》的市占率上升。《南山人壽》也對【貨幣政策】進行了深入分析。有出現: {}. 開始吧.',
#     '在會上，法人表示今年的【ROE】與去年相比顯著提升。《PML》 的專家也討論了【NIM】對市場的影響。有出現: {}. 開始吧.',
#     '[謝冠仁] 在法人說明會中指出，《the banker》 的最新報告對【LDR】的預測非常準確。【預期放款比率】將成為市場的關鍵指標。有出現: {}. 開始吧.',
#     '今年的【淨手續費】顯示《玉山》的收入結構更加健康。[黃男州]強調了【市占率】在競爭中的重要性。有出現: {}. 開始吧.',
#     '會議中，《摩根大通》 分析了【spread】 對全球經濟的影響。《南山》 也分享了其【資本適足率】的調整策略。有出現: {}. 開始吧.',
#     '《玉山金控》 透露了其【淨收益】和【DPS】的穩定增長。法人會議中，【NPL Ratio】 也成為焦點話題。有出現: {}. 開始吧.',
#     '[張智星] 在會上強調了《玉山》的【ROA】提升策略。法人代表同時提到【企金】服務的拓展計劃。有出現: {}. 開始吧.',
#     '《IMF》 的報告指出【資本適足率】對未來市場的影響。法人說明會強調了【BIS Ratio】的重要性。有出現: {}. 開始吧.',
#     '[陳美滿] 在法人說明會中討論了《南山》的財務表現，特別是【LDR】的穩定性。會議還提到【放款】的增長潛力。有出現: {}. 開始吧.',
#     '《元大》 的法人代表提到了【EPS】的改善計劃，並且《富邦》也強調了其【OCI】表現。[柯治宏]表示未來幾年會更加關注【CSR】發展。有出現: {}. 開始吧.',
#     '法人說明會上，《美林證券》分析了【fixed income】在當前市場中的表現。《PML》 分享了他們在【資本適足率】方面的調整策略。有出現: {}. 開始吧.',
#     '[黃男州] 提到《摩根大通》 在【GDP】預測方面的研究成果，並且強調了【預放】在市場上的重要性。《玉山》 的法人代表也分享了【CSR】計劃的進展。有出現: {}. 開始吧.',
#     '《台新》 在會議中提出了【放款】的策略，並且《花旗》也對其【存放比】進行了詳細介紹。[謝冠仁]表示【ROE】將是未來幾年的核心指標。有出現: {}. 開始吧.',
#     '法人說明會上，《南山人壽》 分析了【C I Ratio】的變動趨勢。[張智星]強調了【雙重槓桿比率】對金融市場的重要性。有出現: {}. 開始吧.',
#     '《玉山金控》 在此次法人說明會中提到【市占率】的提升。[陳美滿]分析了【ROA】與【稅後淨利】的變化趨勢。有出現: {}. 開始吧.',
#     '《摩根大通》 會上提到其【稅後盈餘】增長計劃，並且《富邦》也分享了他們在【預放】方面的成功經驗。[張智星]指出市場需求對【存放比】的影響。有出現: {}. 開始吧.',
#     '《南山》的法人代表分享了【稅後淨利】的最新數據，[謝冠仁]強調了【ROE】增長的持續性。《摩根大通》 對【C I Ratio】的表現做了分析。有出現: {}. 開始吧.',
#     '法人會議中，《the banker》 發表了對【NIM】的展望，[黃男州]指出了市場上【GDP】的增長預期。《摩根大通》 也對【spread】進行了分析。有出現: {}. 開始吧.',
#     '[陳美滿] 強調了《玉山金控》 在【BIS Ratio】方面的策略，並且《富邦》 也對【LDR】增長進行了討論。有出現: {}. 開始吧.',
#     '[張智星] 在法人說明會上表示，《玉山金控》 將加強對【預放】的管理。《南山》 也強調了【NPL Ratio】在風險控制中的作用。有出現: {}. 開始吧.',
#     '《摩根大通》 介紹了其【雙重槓桿比率】的變動趨勢，[謝冠仁] 提到《富邦》 在【淨值】增長中的表現突出。會議還討論了【市占率】的未來走勢。有出現: {}. 開始吧.',
#     '在此次法人說明會上，《花旗》 提到【稅後盈餘】的穩定增長。[柯治宏] 表示，《摩根大通》 的【存放比】管理策略是值得借鑒的。有出現: {}. 開始吧.',
#     '《玉山金控》 強調了【LDR】在未來市場中的作用，[黃男州] 也指出《富邦》 在【淨手續費】方面的進展。法人會議討論了【ROE】提升的路徑。有出現: {}. 開始吧.',
#     '[陳美滿] 在會上分析了《摩根大通》 的【ROA】表現，並指出【GDP】增長對於全球市場的重要性。《南山》 也分享了他們的【稅後淨利】數據。有出現: {}. 開始吧.',
#     '法人說明會上，《玉山金控》 強調了【雙重槓桿比率】的穩健性。[謝冠仁] 也分享了《南山人壽》 在【NIM】方面的最新策略。有出現: {}. 開始吧.',
#     '[柯治宏] 在會上提到了《摩根大通》 在【放款】業務上的成功經驗。法人會議還討論了【資本適足率】的增強策略。有出現: {}. 開始吧.',
#     '《花旗》 法人說明會上討論了【預期放款比率】的變化趨勢，[黃男州] 強調了【存放比】在風險管理中的關鍵作用。《南山人壽》 也提到了【ROE】的穩定增長。有出現: {}. 開始吧.',
#     '法人會議中，《玉山金控》 提到了【LDR】和【NPL Ratio】的未來計劃。[張智星] 強調了【GDP】增長對於整體市場的影響。有出現: {}. 開始吧.',
#     '[陳美滿] 在會上指出《玉山》 的【資本適足率】是未來幾年的重點。[謝冠仁] 也分享了《南山人壽》 在【雙重槓桿比率】方面的策略。有出現: {}. 開始吧.',
#     '法人會議中，《南山》 提到其【市占率】的增長計劃，[張智星] 強調了【ROA】對市場競爭的影響。《玉山金控》 也提到了【存放比】的變化趨勢。有出現: {}. 開始吧.',
#     '[黃男州] 在法人說明會中分析了《摩根大通》 在【NIM】方面的表現。《玉山金控》 也提出了他們對【雙重槓桿比率】的管理策略。有出現: {}. 開始吧.',
#     '《花旗》 在法人說明會上介紹了【預放】的未來展望，[謝冠仁] 強調了《南山》 在【存放比】管理上的成功經驗。法人會議還討論了【ROE】的成長潛力。有出現: {}. 開始吧.',
#     '法人會議中，《玉山金控》 提到其【NPL Ratio】的最新數據。[陳美滿] 也分享了《南山人壽》 在【BIS Ratio】管理上的策略。有出現: {}. 開始吧.',
#     '[柯治宏] 在會上表示《摩根大通》 的【稅後淨利】顯著增長，並且法人討論了【LDR】的最新變化。《南山》 也介紹了其【ROA】提升計劃。有出現: {}. 開始吧.',
#     '法人會議中，《玉山金控》 提到其【雙重槓桿比率】的未來目標，[黃男州] 強調了《富邦》 在【市占率】方面的優勢。《南山人壽》 也分享了【ROE】數據。有出現: {}. 開始吧.',
#     '在法人說明會上，《南山》 談到了【NIM】的增長策略，[謝冠仁] 也討論了《玉山金控》 的【稅後淨利】表現。法人會議還分析了【GDP】對市場的影響。有出現: {}. 開始吧.',
#     '法人會議中，《摩根大通》 分析了其【ROA】和【資本適足率】的最新情況。[張智星] 強調了《南山人壽》 在【市占率】方面的成功經驗。有出現: {}. 開始吧.',
#     '[陳美滿] 在法人說明會上分析了《玉山金控》 在【放款】業務上的表現，並討論了【雙重槓桿比率】的未來計劃。《富邦》 也提到其【存放比】的優勢。有出現: {}. 開始吧.',
#     '《花旗》 在會上分享了其【稅後盈餘】增長計劃，[柯治宏] 強調了《摩根大通》 在【NPL Ratio】管理上的成就。《南山》 也討論了【ROE】的增長。有出現: {}. 開始吧.',
#     '在法人說明會上，《玉山金控》 分析了【存放比】的未來走勢，[黃男州] 提到了《富邦》 在【市占率】方面的成功經驗。法人會議還討論了【ROA】的成長潛力。有出現: {}. 開始吧.',
#     '法人會議中，《南山》 提到其【淨收益】的顯著增長。[張智星] 強調了《摩根大通》 在【稅後淨利】方面的持續提升計劃。《玉山金控》 也討論了【存放比】的變化。有出現: {}. 開始吧.',
#     '[陳美滿] 在法人說明會上強調了《南山人壽》 的【NIM】增長計劃，並介紹了《玉山金控》 在【稅後淨利】方面的最新策略。《摩根大通》 也分享了其【存放比】數據。有出現: {}. 開始吧.',
#     '《花旗》 在法人會議中提出了【雙重槓桿比率】的優化策略，[謝冠仁] 強調了《富邦》 在【ROE】增長中的關鍵角色。法人會議還分析了【資本適足率】的調整方向。有出現: {}. 開始吧.',
#     '[張智星] 在法人會議中指出《玉山金控》 在【存放比】上的成功經驗，並且《南山》 也強調了其【市占率】的持續增長。《摩根大通》 分享了【ROA】的最新數據。有出現: {}. 開始吧.',
#     '法人會議中，《花旗》 談到了【雙重槓桿比率】的穩定性，[黃男州] 強調了【NIM】在市場競爭中的重要性。《富邦》 也分享了其【資本適足率】的最新變化。有出現: {}. 開始吧.',
#     '[柯治宏] 在會上強調了《玉山金控》 的【存放比】管理策略，並且《摩根大通》 也分享了其【市占率】的持續增長計劃。法人會議還討論了【ROE】的提升空間。有出現: {}. 開始吧.',
#     '法人會議中，《南山人壽》 分析了其【放款】業務的成長趨勢。[謝冠仁] 強調了《花旗》 在【雙重槓桿比率】管理上的策略，並且法人還討論了【NIM】的未來發展。有出現: {}. 開始吧.',
#     '《玉山金控》 在法人說明會中提到【雙重槓桿比率】的穩定性，[陳美滿] 也討論了《南山》 在【ROA】方面的最新數據。《摩根大通》 也分享了其【資本適足率】的調整計劃。有出現: {}. 開始吧.',
#     '[黃男州] 在法人會議中分享了《玉山》 在【存放比】上的成功策略，並強調了【雙重槓桿比率】對市場的影響。《富邦》 也介紹了他們在【ROE】方面的表現。有出現: {}. 開始吧.',
# ]
# List of 5 unrelated sentences
UNRELATED_SENTENCES = [
    '今天我們要介紹的是花蓮的太魯閣國家公園，這裡以峽谷和瀑布景觀聞名，是登山和健行愛好者的天堂。有出現: {}. 開始吧.',
    '提起義大利美食，披薩和義大利麵是絕對不可錯過的經典菜餚。配上橄欖油、香料和各式食材，每一口都帶有濃郁的地中海風情。有出現: {}. 開始吧.',
    '獅子座的人通常充滿自信，擁有領導能力，喜歡成為人群中的焦點。他們的熱情和創造力，讓身邊的人感受到無限活力。有出現: {}. 開始吧.',
    '在繪畫中，水彩畫以其透明和清新見長，能表現出自然景物的柔和與細膩。初學者可以從簡單的風景畫開始，感受顏料與水交融的樂趣。有出現: {}. 開始吧.',
    '玉山主峰是台灣最高的山峰，海拔3,952公尺，氣勢磅礡，是登山愛好者挑戰自我的絕佳選擇。從山頂眺望，四周群山連綿，令人心曠神怡。有出現: {}. 開始吧.'
]
TRAIN_DEV_BLIST_PATH = "/share/nas169/yuchunliu/espnet_contextual/espnet/egs2/esun/asr1/local/contextual/rarewords/rareword_f1000_train.txt"
TEST_BLIST_PATH      = "/share/nas169/yuchunliu/espnet_contextual/espnet/egs2/esun/asr1/local/contextual/rarewords/rareword_f10_test.txt"

# PROMPT_TEMPLATE         = '''玉山銀行法人說明會是一個定期舉辦的活動，向投資者和法人機構介紹公司財務狀況、業務策略及未來展望。該活動旨在增進透明度，讓法人了解公司的經營績效與市場動態。有出現: {}. 開始吧.'''
PROMPT_NON_ENT_TEMPLATE = '''開始吧.'''
def get_uttblist(words, blist):
    return [[str(word2idx[word]), word] for word in words if word in blist]

def generate_prompt(uttblist, blist, add_random_words=False):
    # 隨機補充uttblist至10個不重複的詞
    if add_random_words and len(uttblist) < 10:
        additional_words = random.sample([word for word in blist if word not in uttblist], 10 - len(uttblist))
        uttblist.extend(additional_words)
    
    # 5% chance to select an unrelated sentence
    if random.random() < 0.05:
        unrelated_template = random.choice(UNRELATED_SENTENCES)
        return unrelated_template.format(", ".join(uttblist))
    
    # Otherwise, select from the regular templates
    if len(uttblist) > 0:
        selected_template = random.choice(PROMPT_TEMPLATE_LIST)
        return selected_template.format(", ".join(uttblist))
    else:
        return PROMPT_NON_ENT_TEMPLATE

if __name__ == '__main__':
    datas_path = '/share/nas169/yuchunliu/espnet_contextual/espnet/egs2/esun/asr1/dump/raw'
    for folder in os.listdir(datas_path):
        path = os.path.join(datas_path, folder)
        if not os.path.isfile(os.path.join(path, 'wav.scp')):
            continue
        if 'test' not in path:
            blist_path = TRAIN_DEV_BLIST_PATH
        else:
            blist_path = TEST_BLIST_PATH
        blist = [b[0] for b in read_file(blist_path, sp=' ')]
        word2idx = {word: i for i, word in enumerate(blist)}

        print(f'processing {path}...')
        text_path  = os.path.join(path, 'text')
        text_datas = read_file(text_path, sp=' ')
        
        rareword_datas = []
        for data in tqdm(text_datas):
            uttid    = data[0]
            results  = get_uttblist(data[1:], blist)
            uttblist = [d[1] for d in results]
            
            # Pass add_random_words=True to enable random word addition if needed
            prompt = generate_prompt(uttblist, blist, add_random_words=True)
            rareword_datas.append([uttid, prompt.upper()])

        output_path_uttblist = os.path.join(path, 'prompt_gen_esun300des_random10')
        write_file(output_path_uttblist, rareword_datas)
